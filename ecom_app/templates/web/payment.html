{% extends 'web/base.html' %}
{% load static %}
{% block content %}

    <!-- PAYMENT PAGE (Flipkart-style layout, White + Brown theme) -->
    <section class="bg-white">
        <div class="px-6 sm:px-10 lg:px-16 py-10 sm:py-14">
            <div class="max-w-7xl mx-auto">

                <!-- Title -->
                <div class="flex items-end justify-between gap-4">
                    <div>
                        <div class="text-sm sm:text-lg text-brownMain font-medium">Payment</div>
                        <h1 class="mt-2 text-3xl sm:text-5xl font-[500] leading-[1.1] tracking-[-0.02em]">
                            Choose a payment method
                        </h1>
                        <p class="mt-3 text-zinc-700 max-w-2xl">
                            Secure payments with UPI, cards, net banking, wallet, or cash on delivery.
                        </p>
                    </div>

                    <a href="checkout.html"
                        class="hidden sm:inline-flex items-center gap-2 rounded-xl border border-brownMain text-brownMain px-4 py-2 text-sm font-semibold hover:bg-soft transition">
                        Back to Checkout
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 18l-6-6 6-6" />
                        </svg>
                    </a>
                </div>

                <div class="mt-8 grid gap-8 lg:grid-cols-12 items-start">

                    <!-- LEFT: Payment methods (Tabs + content) -->
                    <div class="lg:col-span-8">

                     
                            <div class="grid md:grid-cols-12">

                                <!-- Left vertical tabs -->
                               

                                <!-- Right content -->
                                <div class="md:col-span-8 p-6 sm:p-8">

                                
                                   <aside class="lg:col-span-4 lg:sticky lg:top-24">
                                    <div class="rounded-3xl border border-line bg-white overflow-hidden">
                                        <div class="px-6 py-5 bg-soft border-b border-line">
                                            <h2 class="text-lg font-semibold text-zinc-900">Price details</h2>
                                            <p class="text-sm text-zinc-600 mt-1">3 items</p>
                                        </div>

                                        <div class="p-6 space-y-4 text-sm">
                                            <div class="flex items-center justify-between text-zinc-700">
                                                <span>Subtotal</span>
                                                <span id="p_subtotal">₹2,097</span>
                                            </div>
                                            <div class="flex items-center justify-between text-zinc-700">
                                                <span>Delivery</span>
                                                <span id="p_delivery">₹0</span>
                                            </div>
                                            <div class="flex items-center justify-between text-zinc-700">
                                                <span>Discount</span>
                                                <span id="p_discount">₹0</span>
                                            </div>

                                            <div
                                                class="pt-3 border-t border-line flex items-center justify-between text-zinc-900 font-semibold">
                                                <span>Total payable</span>
                                                <span id="p_total">₹2,097</span>
                                            </div>

                                            <button id="rzp-button"
                                                        class="w-full rounded-2xl bg-brownMain text-white py-3.5 text-sm font-semibold hover:bg-brownDark transition">
                                                        Pay ₹{{ order.total_amount|floatformat:0 }}
                                                    </button>
                                            <div class="text-xs text-zinc-500 leading-relaxed">
                                                Clicking “Continue” will proceed with the selected payment option.
                                            </div>
                                            
                                        </div>
                                    </div>
                                </aside>

                                    

                                  

                             

                                </div>
                            </div>
                     

                        <!-- Security note -->
                        <div class="mt-5 text-xs text-zinc-500 flex items-center gap-2">
                            <svg class="h-4 w-4 text-brownMain" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                                <path d="M9 12l2 2 4-4" />
                            </svg>
                            Payments are secured using encrypted connections. Never share OTPs or passwords.
                        </div>

                    </div>

                    <!-- RIGHT: Order summary -->
                  

                </div>
            </div>
        </div>
    </section>





<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
    const csrfToken = "{{ csrf_token }}";

    document.getElementById("rzp-button").addEventListener("click", function (e) {
        e.preventDefault();

        var options = {
            key: "{{ razorpay_key }}",
            amount: {{ razorpay_amount }},
            currency: "INR",
            name: "Kanthi Mantra",
            description: "Order Payment",
            order_id: "{{ razorpay_order_id }}",

            prefill: {
                name: "{{ request.user.get_full_name|default:'' }}",
                email: "{{ request.user.email|default:'' }}",
                contact: "{{ order.shipping.phone|default:'' }}"
            },

            handler: function (response) {
                const form = document.createElement("form");
                form.method = "POST";
                form.action = "{% url 'web:payment_success' %}";

                form.innerHTML = `
                    <input type="hidden" name="csrfmiddlewaretoken" value="${csrfToken}">
                    <input type="hidden" name="razorpay_payment_id" value="${response.razorpay_payment_id}">
                    <input type="hidden" name="razorpay_order_id" value="${response.razorpay_order_id}">
                    <input type="hidden" name="razorpay_signature" value="${response.razorpay_signature}">
                `;

                document.body.appendChild(form);
                form.submit();
            },

            theme: { color: "#6B3F2A" }
        };

        new Razorpay(options).open();
    });
</script>





{% endblock %}